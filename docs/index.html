<html>
  <head>
    <title>Gravity simulation</title>
    <meta charset='utf8'/>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
      body{
        margin:0;
        padding:0;
      }
      canvas{
        width:100%;
        height:100%;
      }
    </style>
    <script>
      const SPACE=10;
      const STARS=[];
      const G=100;
      const TICK=1000/30;
      const DECAY=1.01;
      
      class Star{
        constructor(x,y){
          this.x=x;
          this.y=y;
          this.movex=0;
          this.movey=0;
          this.color=
            'rgba('+this.random()+','+this.random()+','+this.random()+',1)'
          STARS.push(this);
        }
        
        random(){
          return 128+Math.round(Math.random()*127);
        }
        
        move(x,movex,width){
          x+=movex;
          if(x>width){
            x=width-(x-width);
            movex*=-1;
          }else if(x<0){
            x*=-1;
            movex*=-1;
          }
          movex/=DECAY;
          return [x,movex];
        }
        
        force(){
          if(force!=0){
            let distance=Math.abs((source.x-this.x)*(source.x-this.x)+(source.y-this.y)*(source.y-this.y));
            this.movex+=(source.x>this.x?-force:+force)*G/distance;
            this.movey+=(source.y>this.y?-force:+force)*G/distance;
          }
          [this.x,this.movex]=this.move(this.x,this.movex,width);
          [this.y,this.movey]=this.move(this.y,this.movey,height);
        }
      }
      
      var width;
      var height;
      var force=0;
      var source=false;
      var canvas=false;
      
      function simulate(){
        canvas.fillStyle='black'
        canvas.fillRect(0,0,width,height);
        for(let s of STARS){
          if(force!=0) s.force(source);
          canvas.fillStyle=s.color;
          canvas.fillRect(Math.round(s.x),Math.round(s.y),1,1);
        }
      }
      
      function generate(){
        width=document.body.clientWidth;
        height=document.body.clientHeight;
        for(let x=SPACE;x<width;x+=SPACE){
          for(let y=SPACE;y<height;y+=SPACE){
            new Star(x,y);
          }
        }
        canvas=document.querySelector('canvas');
        canvas.width=width;
        canvas.height=height;
        canvas=canvas.getContext('2d');
        setInterval(simulate,TICK);
      }
      
      window.onmousedown=function(e){force=e.button==0?+1:-1;}
      window.ontouchstart=window.onmousedown;
      window.onmouseup=function(e){force=0;}
      window.ontouchend=window.onmouseup;
      window.oncontextmenu=function(e){e.preventDefault();}
      window.onmousemove=function(e){
        source.x=e.clientX;
        source.y=e.clientY;
      }
    </script>
  </head>
  <body onload='generate();'>
    <canvas></canvas>
  </body>
  <script>
  </script>
</html>
